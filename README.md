# MPATH
This is an R library for analysis of differential expression of genes in human mitochondria-related pathways, developed by the Woods lab at Northeastern University.

### Install as an R library
The code can be installed using devtools:

install.packages("devtools") 
library(devtools) 
install_github("AudenCote/MPATH") 

## Using the pipeline

### Input

The pipeline takes a spreadsheet of expression data as input, with 4 variables. See the tab-separated file "ExampleExpressionData.tsv" for an example of how this file should be formatted. Each row should represent a gene, with the first column, titled "Gene", an Ensembl ID (ENSG...). There are three fields for sample identification, labelled "Culture", "Sample", and "Replicate", but only "Sample" and "Replicate" need to be used -- just enter a constant filler value to "Culture" if needed (though NOT "NA"). At least 2 replicates are required for each sample. The fourth column should be labelled "Exp" and contains the (numeric) expression value for each gene & sample.

### Pipeline initialization

To begin using the pipeline, load it into an R script using

library(MPATH)

then initialize a new pipeline object. The pipeline uses a reference class structure, so all data and plots generated by the pipeline will be linked to this pipeline object. This pipeline does NOT write any output files, but generates dataframes, plots, etc. as variables in R and linked to the pipeline object that are mutable and writable by the user. To initialize a new pipeline object, e.g.

mpath <- MPATH_Pipeline(expression_file = 'ExampleExpressionData.tsv')

Right away, you should be able to access the variable mpath$expression_data, which is your input dataset as a data.frame object. The field mpath$mitocarta_data will also be populated at this stage (see below).

### Volcano plots

The function mpath$Volcano() generates volcano plots and differential expression dataframes that are used by other functions listed below, so this function should be run before any others. It takes two optional argumets, "benchmark_sample" and "compared_samples." Using the ExampleExpressionData.tsv, one could try the following:

mpath$Volcano(benchmark_sample = '1', compared_samples = c('3', '12', '20'))

This would then restrict all downstream analysis to the change in expression between samples 1 & 3, samples 1 & 12, and samples 1 & 20. If no values are given, the benchmark sample will be set to the first sample in the input column "Sample" and will be compared to all other samples. Once this function has been run, the fields mpath$log2fc_pval_dataframe (a dataframe with Log(2FC) and p-values for each sample comparison for each gene) and mpath$volcano_plots will be populated (one for each sample comparison, accessible as mpath$volcano_plots$12 for the comparison of samples 1 & 12, for instance).

### Identifying genes of interest

The function mpath$GeneRegulation() identifies genes of interest based on a threshold for Log(2FC) and P-value. The Volcano() function must be run before this one. The default thresholds are 1.5 and 0.01 respectively, but these can be assigned using the log2fc_threshold and pval_threshold arguments to the function. It also creates a barplot with the number of significantly up- and down-regulated genes for each sample comparison. This populates the field mpath$regulation_barplot. It also creates a matrix of expression values for only the genes of interest (for use later in the PCA() function), mpath$goi_expression. E.g.

mpath$GeneRegulation(log2fc_threshold = 2, pval_threshold = 0.01)

### Principal component analysis
This function takes no arguments but depends on data generated by the Volcano() and GeneRegulation() functions, and returns several variables related to principal component analysis. These are all accessible in the mpath$pca variable:

mpath$pca$pca_plot graphs a PCA of each sample by their expression data from the mpath$goi_expression matrix
mpath$pca$elbow_plot graphs an elbow plot from the goi_expression data
mpath$pca$loadings is a dataframe of all loadings from the two PCs in the PCA graph
mpath$loadings_plot graphs the loadings for all genes

### Pathway analysis
This function depends on data generated by the Volcano() and GeneRegulation() functions and the MitoCarta 3.0 (found in the "Data" folder) and Panther datasets (accessed through the Panther API). It takes two arguments, the pathway dataset to use ("Panther" or "MitoCarta"; if not given both will be used) and the number of "top pathways" to plot (default = 5). Using the MitoCarta dataset, the function creates a dataframe with the number of significantly up- or down-regulated genes involved in each pathway, accessible as mpath$pathways$mitocarta_frequencies; it also plots these frequencies in a simple barplot (mpath$pathways$plots$mitocarta.up and mpath$pathways$plots$mitocarta.down). It can do the same using the Panther dataset (mpath$pathways$panther_frequences, mpath$pathways$plots$panther.up and mpath$pathways$plots$panther.down). As an option only for the MitoCarta pathway dataset, the function also creates a set of heatmaps showing Log(2FC) for each sample comparison for significantly up- and down-regulated genes, with one heatmap for each of the top most frequent up- and down-regulated pathways (number of pathways given in the top_path_n argument), accessible as mpath$pathways$plots$heatmaps$<pathway name> (press tab for options). Lastly, for the MitoCarta data, the function creates a dataframe with the Log2FC and p-values for each gene and sample in these top pathways, with the pathways given (mpath$top_pathway_genes_l2fcp). E.g.

mpath$Pathways(method = "MitoCarta", top_path_n = 3)

### Example
A whole pipeline run looks relatively simple:

require(MPATH)

mpath <- MPATH_Pipeline(expression_file = 'ExampleExpressionData.tsv')
mpath$Volcano()
mpath$GeneRegulation()
mpath$PCA()
mpath$Pathways()











